<ng-container
  *ngIf="{
    isEdit: type === 'edit',
    isCreate: type === 'create',
    isDelete: type === 'delete',
    isEditDashboard: type === 'editDashboard',
    open: open$ | async
  } as vars"
>
  <ng-container
    *ngIf="{
      edit: vars.isEdit && ('dashboardManagement.widgets.edit' | translate),
      create: vars.isCreate && ('dashboardManagement.widgets.add' | translate),
      delete: vars.isDelete && ('dashboardManagement.widgets.delete' | translate),
      editDashboard:
        vars.isEditDashboard && ('dashboardManagement.widgets.editDashboard' | translate)
    } as titles"
  >
    <ibm-modal
      *ngIf="{
        title: titles.edit || titles.create || titles.delete || titles.editDashboard
      } as translations"
      [open]="vars.open"
      showFooter="true"
      title="{{ translations.title }}"
      valtimoIbmModal
    >
      <ibm-modal-header [showCloseButton]="true" (closeSelect)="closeModal()">
        <h3 ibmModalHeaderHeading>
          {{ translations.title }}
        </h3>
      </ibm-modal-header>
      <section ibmModalContent>
        <ng-container *ngIf="vars.isDelete">
          {{ 'dashboardManagement.widgets.deleteDescription' | translate }}</ng-container
        >
        <ng-container *ngIf="vars.isEdit || vars.isCreate">
          <ng-container *ngTemplateOutlet="widgetForm"></ng-container>
        </ng-container>
        <ng-container *ngIf="vars.isEditDashboard">
          <ng-container *ngTemplateOutlet="editDashboardFormTemplate"></ng-container>
        </ng-container>
      </section>
      <ibm-modal-footer>
        <ng-container *ngIf="vars.isEdit || vars.isCreate">
          <ng-container *ngTemplateOutlet="editButtons"></ng-container>
        </ng-container>
        <ng-container *ngIf="vars.isDelete">
          <ng-container *ngTemplateOutlet="deleteButtons"></ng-container>
        </ng-container>
        <ng-container *ngIf="vars.isEditDashboard">
          <ng-container *ngTemplateOutlet="editDashboardButtons"></ng-container>
        </ng-container>
      </ibm-modal-footer>
    </ibm-modal>
  </ng-container>
</ng-container>

<ng-template #editDashboardFormTemplate>
  <form *ngIf="editDashboardForm" [formGroup]="editDashboardForm" class="dashboard-modal__form">
    <div class="form__element">
      <ibm-label [invalid]="dashboardTitle.dirty && dashboardTitle.invalid">
        {{ 'dashboardManagement.widgets.form.dashboardTitle' | translate }}
        <input
          formControlName="title"
          ibmText
          [attr.modal-primary-focus]="true"
          [invalid]="dashboardTitle.dirty && dashboardTitle.invalid"
        />
      </ibm-label>
    </div>
    <div class="form__element">
      <ibm-label
        [invalid]="dashboardDescription.dirty && dashboardDescription.invalid"
        [helperText]="'dashboardManagement.widgets.form.dashboardDescriptionHelperText' | translate"
        [invalidText]="
          'dashboardManagement.widgets.form.dashboardDescriptionHelperText' | translate
        "
      >
        {{ 'dashboardManagement.widgets.form.dashboardDescription' | translate }}
        <input
          formControlName="description"
          ibmText
          [attr.modal-primary-focus]="true"
          [invalid]="dashboardDescription.dirty && dashboardDescription.invalid"
        />
      </ibm-label>
    </div>
    <div class="form__element">
      <ibm-dropdown
        type="multi"
        formControlName="roles"
        [invalid]="dashboardRoles.dirty && dashboardRoles.invalid"
        [label]="'dashboardManagement.widgets.form.roles' | translate"
      >
        <ibm-dropdown-list [items]="roleItems$ | async"></ibm-dropdown-list>
      </ibm-dropdown>
    </div>
  </form>
</ng-template>

<ng-template #widgetForm>
  <form *ngIf="form" [formGroup]="form" class="dashboard-modal__form">
    <div class="form__element">
      <ibm-label
        [invalid]="title.dirty && title.invalid"
        [helperText]="'dashboardManagement.widgets.form.titleHelperText' | translate"
      >
        {{ 'dashboardManagement.widgets.form.title' | translate }}
        <input
          formControlName="title"
          ibmText
          [attr.modal-primary-focus]="true"
          [invalid]="title.dirty && title.invalid"
        />
      </ibm-label>
    </div>
    <div class="form__element --with-button --readonly">
      <ibm-label [disabled]="true" [invalid]="key.dirty && key.invalid">
        {{ 'dashboardManagement.widgets.form.key' | translate }}
        <input
          formControlName="key"
          ibmText
          [invalid]="key.dirty && key.invalid"
          [placeholder]="key.value"
        />
      </ibm-label>
      <button
        [title]="'dashboardManagement.widgets.form.keyTitle' | translate"
        ibmButton="ghost"
        (click)="copyKey()"
        [iconOnly]="true"
      >
        <svg class="cds--btn__icon" ibmIconCopy size="16"></svg>
      </button>
    </div>
    <div class="form__element">
      <ibm-dropdown
        formControlName="dateSource"
        [invalid]="dataSource.dirty && dataSource.invalid"
        [label]="'dashboardManagement.widgets.form.dataSource' | translate"
        [helperText]="'dashboardManagement.widgets.form.dataSourceHelperText' | translate"
        [invalidText]="'dashboardManagement.widgets.form.dateSourceHelperText' | translate"
        (selected)="dataSourceSelected($event)"
      >
        <ibm-dropdown-list [items]="dataSourceItems$ | async" type="multi"></ibm-dropdown-list>
      </ibm-dropdown>
    </div>
    <div class="form__row">
      <div class="form__element">
        <ibm-dropdown
          formControlName="chartType"
          [invalid]="chartType.dirty && chartType.invalid"
          [label]="'dashboardManagement.widgets.form.chartType' | translate"
          (selected)="chartTypeSelected($event)"
        >
          <ibm-dropdown-list [items]="dataSourceItems$ | async" type="multi"></ibm-dropdown-list>
        </ibm-dropdown>
      </div>
      <div class="form__spacer"></div>
      <div class="form__element">
        <ibm-label [invalid]="dataSourceField.dirty && dataSourceField.invalid">
          {{ 'dashboardManagement.widgets.form.dataSourceField' | translate }}
          <input
            formControlName="dataSourceField"
            ibmText
            [invalid]="dataSourceField.dirty && dataSourceField.invalid"
          />
        </ibm-label>
      </div>
    </div>
  </form>
</ng-template>

<ng-template #editButtons>
  <button ibmButton="ghost" (click)="closeModal()">
    {{ 'dashboardManagement.widgets.cancel' | translate }}
  </button>
  <button (click)="save()" ibmButton="primary" [disabled]="form.invalid">
    {{ 'dashboardManagement.widgets.save' | translate }}
  </button>
</ng-template>

<ng-template #deleteButtons>
  <button ibmButton="secondary" (click)="closeModal()">
    {{ 'dashboardManagement.widgets.cancel' | translate }}
  </button>
  <button (click)="delete()" ibmButton="danger">
    {{ 'dashboardManagement.widgets.delete' | translate }}
  </button>
</ng-template>

<ng-template #editDashboardButtons>
  <button ibmButton="ghost" (click)="closeModal()">
    {{ 'dashboardManagement.widgets.cancel' | translate }}
  </button>
  <button (click)="saveDashboard()" ibmButton="primary" [disabled]="editDashboardForm.invalid">
    {{ 'dashboardManagement.widgets.complete' | translate }}
  </button>
</ng-template>
