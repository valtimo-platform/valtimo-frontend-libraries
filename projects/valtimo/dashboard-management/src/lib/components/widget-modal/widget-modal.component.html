<ng-container
  *ngIf="{
    isEdit: type === 'edit',
    isCreate: type === 'create',
    isDelete: type === 'delete',
    open: open$ | async
  } as vars"
>
  <ibm-modal
    *ngIf="{
      title: vars.isEdit
        ? ('dashboardManagement.widgets.edit' | translate)
        : vars.isCreate
        ? ('dashboardManagement.widgets.add' | translate)
        : ('dashboardManagement.widgets.delete' | translate)
    } as translations"
    [open]="vars.open"
    showFooter="true"
    title="{{ translations.title }}"
    valtimoIbmModal
  >
    <ibm-modal-header [showCloseButton]="true" (closeSelect)="closeModal()">
      <h3 ibmModalHeaderHeading>
        {{ translations.title }}
      </h3>
    </ibm-modal-header>
    <section ibmModalContent>
      <ng-container *ngIf="vars.isDelete">
        {{ 'dashboardManagement.widgets.deleteDescription' | translate }}</ng-container
      >
      <ng-container *ngIf="!vars.isDelete">
        <ng-container *ngTemplateOutlet="widgetForm"></ng-container>
      </ng-container>
    </section>
    <ibm-modal-footer>
      <ng-container *ngIf="vars.isEdit || vars.isCreate">
        <ng-container *ngTemplateOutlet="editButtons"></ng-container>
      </ng-container>
      <ng-container *ngIf="vars.isDelete">
        <ng-container *ngTemplateOutlet="deleteButtons"></ng-container>
      </ng-container>
    </ibm-modal-footer>
  </ibm-modal>
</ng-container>
<ng-template #widgetForm>
  <form *ngIf="form" [formGroup]="form" class="dashboard-modal__form">
    <div class="widget-form__element">
      <ibm-label
        [invalid]="title.dirty && title.invalid"
        [helperText]="'dashboardManagement.widgets.form.titleHelperText' | translate"
      >
        {{ 'dashboardManagement.widgets.form.title' | translate }}
        <input
          formControlName="title"
          ibmText
          [attr.modal-primary-focus]="true"
          [invalid]="title.dirty && title.invalid"
        />
      </ibm-label>
    </div>
    <div class="widget-form__element --with-button --readonly">
      <ibm-label [disabled]="true" [invalid]="key.dirty && key.invalid">
        {{ 'dashboardManagement.widgets.form.key' | translate }}
        <input
          formControlName="key"
          ibmText
          [invalid]="key.dirty && key.invalid"
          [placeholder]="key.value"
        />
      </ibm-label>
      <button ibmButton="ghost" (click)="copyKey()" [iconOnly]="true">
        <svg class="cds--btn__icon" ibmIconCopy size="16"></svg>
      </button>
    </div>
    <div class="widget-form__element">
      <ibm-dropdown
        formControlName="dateSource"
        [invalid]="dataSource.dirty && dataSource.invalid"
        [label]="'dashboardManagement.widgets.form.dataSource' | translate"
        [helperText]="'dashboardManagement.widgets.form.dataSourceHelperText' | translate"
        [invalidText]="'dashboardManagement.widgets.form.dateSourceHelperText' | translate"
        (selected)="dataSourceSelected($event)"
      >
        <ibm-dropdown-list [items]="dataSourceItems$ | async" type="multi"></ibm-dropdown-list>
      </ibm-dropdown>
    </div>
    <div class="widget-form__row">
      <div class="widget-form__element">
        <ibm-dropdown
          formControlName="chartType"
          [invalid]="chartType.dirty && chartType.invalid"
          [label]="'dashboardManagement.widgets.form.chartType' | translate"
          (selected)="chartTypeSelected($event)"
        >
          <ibm-dropdown-list [items]="dataSourceItems$ | async" type="multi"></ibm-dropdown-list>
        </ibm-dropdown>
      </div>
      <div class="widget-form__spacer"></div>
      <div class="widget-form__element">
        <ibm-label [invalid]="dataSourceField.dirty && dataSourceField.invalid">
          {{ 'dashboardManagement.widgets.form.dataSourceField' | translate }}
          <input
            formControlName="dataSourceField"
            ibmText
            [invalid]="dataSourceField.dirty && dataSourceField.invalid"
          />
        </ibm-label>
      </div>
    </div>
  </form>
</ng-template>

<ng-template #editButtons>
  <button ibmButton="ghost" (click)="closeModal()">
    {{ 'dashboardManagement.widgets.cancel' | translate }}
  </button>
  <button (click)="save()" ibmButton="primary" [disabled]="form.invalid">
    {{ 'dashboardManagement.widgets.save' | translate }}
  </button>
</ng-template>

<ng-template #deleteButtons>
  <button ibmButton="secondary" (click)="closeModal()">
    {{ 'dashboardManagement.widgets.cancel' | translate }}
  </button>
  <button (click)="delete()" ibmButton="danger">
    {{ 'dashboardManagement.widgets.delete' | translate }}
  </button>
</ng-template>
