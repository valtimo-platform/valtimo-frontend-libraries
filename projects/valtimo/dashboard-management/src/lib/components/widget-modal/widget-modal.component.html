<ng-container
  *ngIf="{
    isEdit: type === 'edit',
    isCreate: type === 'create',
    isDelete: type === 'delete',
    isEditDashboard: type === 'editDashboard',
    open: open$ | async
  } as vars"
>
  <ng-container
    *ngIf="{
      edit: vars.isEdit && ('dashboardManagement.widgets.edit' | translate),
      create: vars.isCreate && ('dashboardManagement.widgets.add' | translate),
      delete: vars.isDelete && ('dashboardManagement.widgets.delete' | translate),
      editDashboard:
        vars.isEditDashboard && ('dashboardManagement.widgets.editDashboard' | translate)
    } as titles"
  >
    <cds-modal
      *ngIf="{
        title: titles.edit || titles.create || titles.delete || titles.editDashboard
      } as translations"
      [open]="vars.open"
      showFooter="true"
      title="{{ translations.title }}"
      valtimoCdsModal
    >
      <cds-modal-header [showCloseButton]="true" (closeSelect)="closeModal()">
        <h3 cdsModalHeaderHeading>
          {{ translations.title }}
        </h3>
      </cds-modal-header>

      <section cdsModalContent>
        <ng-container *ngIf="vars.isDelete">
          {{ 'dashboardManagement.widgets.deleteDescription' | translate }}</ng-container
        >

        <ng-container *ngIf="vars.isEdit || vars.isCreate">
          <ng-container *ngTemplateOutlet="widgetForm"></ng-container>
        </ng-container>

        <ng-container *ngIf="vars.isEditDashboard">
          <ng-container *ngTemplateOutlet="editDashboardFormTemplate"></ng-container>
        </ng-container>
      </section>

      <cds-modal-footer>
        <ng-container *ngIf="vars.isEdit || vars.isCreate">
          <ng-container *ngTemplateOutlet="editButtons"></ng-container>
        </ng-container>

        <ng-container *ngIf="vars.isDelete">
          <ng-container *ngTemplateOutlet="deleteButtons"></ng-container>
        </ng-container>

        <ng-container *ngIf="vars.isEditDashboard">
          <ng-container *ngTemplateOutlet="editDashboardButtons"></ng-container>
        </ng-container>
      </cds-modal-footer>
    </cds-modal>
  </ng-container>
</ng-container>

<ng-template #editDashboardFormTemplate>
  <form *ngIf="editDashboardForm" [formGroup]="editDashboardForm" class="dashboard-modal__form">
    <div class="form__element">
      <cds-label [invalid]="dashboardTitle.dirty && dashboardTitle.invalid">
        {{ 'dashboardManagement.widgets.form.dashboardTitle' | translate }}

        <input
          formControlName="title"
          cdsText
          [attr.modal-primary-focus]="true"
          [invalid]="dashboardTitle.dirty && dashboardTitle.invalid"
        />
      </cds-label>
    </div>

    <div class="form__element">
      <cds-label
        [invalid]="dashboardDescription.dirty && dashboardDescription.invalid"
        [helperText]="'dashboardManagement.widgets.form.dashboardDescriptionHelperText' | translate"
        [invalidText]="
          'dashboardManagement.widgets.form.dashboardDescriptionHelperText' | translate
        "
      >
        {{ 'dashboardManagement.widgets.form.dashboardDescription' | translate }}

        <input
          formControlName="description"
          cdsText
          [attr.modal-primary-focus]="true"
          [invalid]="dashboardDescription.dirty && dashboardDescription.invalid"
        />
      </cds-label>
    </div>

    <div class="form__element">
      <cds-dropdown
        data-carbon-theme="g10"
        type="multi"
        formControlName="roles"
        [invalid]="dashboardRoles.dirty && dashboardRoles.invalid"
        [label]="'dashboardManagement.widgets.form.roles' | translate"
      >
        <cds-dropdown-list [items]="roleItems$ | async"></cds-dropdown-list>
      </cds-dropdown>
    </div>
  </form>
</ng-template>

<ng-template #widgetForm>
  <form *ngIf="form" [formGroup]="form" class="dashboard-modal__form">
    <div class="form__element">
      <cds-label
        [invalid]="title.dirty && title.invalid"
        [helperText]="'dashboardManagement.widgets.form.titleHelperText' | translate"
      >
        {{ 'dashboardManagement.widgets.form.title' | translate }}

        <input
          formControlName="title"
          cdsText
          [attr.modal-primary-focus]="true"
          [invalid]="title.dirty && title.invalid"
        />
      </cds-label>
    </div>

    <!--    <div class="form__element &#45;&#45;with-button &#45;&#45;readonly">-->
    <!--      <cds-label [invalid]="key.dirty && key.invalid">-->
    <!--        {{ 'dashboardManagement.widgets.form.key' | translate }}-->

    <!--        <input-->
    <!--          formControlName="key"-->
    <!--          cdsText-->
    <!--          readonly-->
    <!--          tabindex="-1"-->
    <!--          [invalid]="key.dirty && key.invalid"-->
    <!--          [placeholder]="key.value"-->
    <!--        />-->
    <!--      </cds-label>-->

    <!--      <button-->
    <!--        [title]="'dashboardManagement.widgets.form.keyTitle' | translate"-->
    <!--        cdsButton="ghost"-->
    <!--        (click)="copyKey()"-->
    <!--        [iconOnly]="true"-->
    <!--      >-->
    <!--        <svg class="cds&#45;&#45;btn__icon" cdsIcon="copy" size="16"></svg>-->
    <!--      </button>-->
    <!--    </div>-->

    <div class="form__element">
      <cds-dropdown
        formControlName="dateSource"
        [invalid]="dataSource.dirty && dataSource.invalid"
        [label]="'dashboardManagement.widgets.form.dataSource' | translate"
        [helperText]="'dashboardManagement.widgets.form.dataSourceHelperText' | translate"
        [invalidText]="'dashboardManagement.widgets.form.dateSourceHelperText' | translate"
        (selected)="dataSourceSelected($event)"
      >
        <cds-dropdown-list [items]="dataSourceItems$ | async" type="multi"></cds-dropdown-list>
      </cds-dropdown>
    </div>

    <!--    <div class="form__row">-->
    <!--      <div class="form__element">-->
    <!--        <cds-dropdown-->
    <!--          formControlName="chartType"-->
    <!--          [invalid]="chartType.dirty && chartType.invalid"-->
    <!--          [label]="'dashboardManagement.widgets.form.chartType' | translate"-->
    <!--          (selected)="chartTypeSelected($event)"-->
    <!--        >-->
    <!--          <cds-dropdown-list [items]="dataSourceItems$ | async" type="multi"></cds-dropdown-list>-->
    <!--        </cds-dropdown>-->
    <!--      </div>-->

    <!--      <div class="form__spacer"></div>-->

    <!--      <div class="form__element">-->
    <!--        <cds-label [invalid]="dataSourceField.dirty && dataSourceField.invalid">-->
    <!--          {{ 'dashboardManagement.widgets.form.dataSourceField' | translate }}-->
    <!--          <input-->
    <!--            formControlName="dataSourceField"-->
    <!--            cdsText-->
    <!--            [invalid]="dataSourceField.dirty && dataSourceField.invalid"-->
    <!--          />-->
    <!--        </cds-label>-->
    <!--      </div>-->
    <!--    </div>-->
  </form>
</ng-template>

<ng-template #editButtons>
  <button cdsButton="ghost" (click)="closeModal()">
    {{ 'dashboardManagement.widgets.cancel' | translate }}
  </button>

  <button (click)="save()" cdsButton="primary" [disabled]="form.invalid">
    {{ 'dashboardManagement.widgets.save' | translate }}
  </button>
</ng-template>

<ng-template #deleteButtons>
  <button cdsButton="secondary" (click)="closeModal()">
    {{ 'dashboardManagement.widgets.cancel' | translate }}
  </button>

  <button (click)="delete()" cdsButton="danger">
    {{ 'dashboardManagement.widgets.delete' | translate }}
  </button>
</ng-template>

<ng-template #editDashboardButtons>
  <button cdsButton="ghost" (click)="closeModal()">
    {{ 'dashboardManagement.widgets.cancel' | translate }}
  </button>

  <button (click)="saveDashboard()" cdsButton="primary" [disabled]="editDashboardForm.invalid">
    {{ 'dashboardManagement.widgets.complete' | translate }}
  </button>
</ng-template>
