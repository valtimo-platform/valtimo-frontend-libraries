<!--
  ~ Copyright 2015-2023 Ritense BV, the Netherlands.
  ~
  ~ Licensed under EUPL, Version 1.2 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ https://joinup.ec.europa.eu/collection/eupl/eupl-text-eupl-12
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" basis,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<cds-modal
  [open]="open$ | async"
  showFooter="true"
  title="{{ 'dashboardManagement.widgets.editDashboard' | translate }}"
  valtimoCdsModal
>
  <cds-modal-header [showCloseButton]="true" (closeSelect)="closeModal()">
    <h3 cdsModalHeaderHeading>{{ 'dashboardManagement.widgets.editDashboard' | translate }}</h3>
  </cds-modal-header>

  <section cdsModalContent>
    <ng-container *ngTemplateOutlet="editDashboardFormTemplate"></ng-container>
  </section>

  <cds-modal-footer>
    <ng-container *ngTemplateOutlet="editDashboardButtons"></ng-container>
  </cds-modal-footer>
</cds-modal>

<ng-template #editDashboardFormTemplate>
  <form *ngIf="editDashboardForm" [formGroup]="editDashboardForm" class="dashboard-modal__form">
    <div class="form__element">
      <cds-label [invalid]="dashboardTitle.dirty && dashboardTitle.invalid">
        {{ 'dashboardManagement.widgets.form.dashboardTitle' | translate }}

        <input
          formControlName="title"
          cdsText
          [attr.modal-primary-focus]="true"
          [invalid]="dashboardTitle.dirty && dashboardTitle.invalid"
        />
      </cds-label>
    </div>

    <div class="form__element">
      <cds-label
        [invalid]="dashboardDescription.dirty && dashboardDescription.invalid"
        [helperText]="'dashboardManagement.widgets.form.dashboardDescriptionHelperText' | translate"
        [invalidText]="
          'dashboardManagement.widgets.form.dashboardDescriptionHelperText' | translate
        "
      >
        {{ 'dashboardManagement.widgets.form.dashboardDescription' | translate }}

        <input
          formControlName="description"
          cdsText
          [attr.modal-primary-focus]="true"
          [invalid]="dashboardDescription.dirty && dashboardDescription.invalid"
        />
      </cds-label>
    </div>

    <div class="form__element">
      <cds-dropdown
        data-carbon-theme="g10"
        type="multi"
        formControlName="roles"
        [invalid]="dashboardRoles.dirty && dashboardRoles.invalid"
        [label]="'dashboardManagement.widgets.form.roles' | translate"
      >
        <cds-dropdown-list [items]="roleItems$ | async"></cds-dropdown-list>
      </cds-dropdown>
    </div>
  </form>
</ng-template>

<ng-template #editDashboardButtons>
  <button cdsButton="ghost" (click)="closeModal()">
    {{ 'dashboardManagement.widgets.cancel' | translate }}
  </button>

  <button (click)="saveDashboard()" cdsButton="primary" [disabled]="editDashboardForm.invalid">
    {{ 'dashboardManagement.widgets.complete' | translate }}
  </button>
</ng-template>
