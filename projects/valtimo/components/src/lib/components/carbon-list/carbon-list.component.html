<!--
  ~ Copyright 2015-2023 Ritense BV, the Netherlands.
  ~
  ~ Licensed under EUPL, Version 1.2 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ https://joinup.ec.europa.eu/collection/eupl/eupl-text-eupl-12
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" basis,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<cds-table-container
  *ngIf="{
    sort: sort$ | async
  } as obs"
>
  <cds-table-header *ngIf="header">
    <ng-content select="[header]"></ng-content>
  </cds-table-header>

  <ng-content select="[tabs]"></ng-content>

  <cds-table-toolbar
    class="valtimo-carbon-list__toolbar"
    [model]="model"
    [batchText]="batchText$ | async"
    (cancel)="onToolbarCancel()"
  >
    <cds-table-toolbar-actions>
      <ng-content select="[carbonToolbarActions]"> </ng-content>
    </cds-table-toolbar-actions>

    <cds-table-toolbar-content>
      <cds-table-toolbar-search
        *ngIf="isSearchable"
        [expandable]="true"
        [formControl]="searchFormControl"
      ></cds-table-toolbar-search>

      <ng-container *ngIf="!loading && !!viewMode">
        <cds-overflow-menu [customTrigger]="viewModeTrigger">
          <cds-overflow-menu-option (selected)="switchView('table')">{{
            'interface.list.viewMode.table' | translate
          }}</cds-overflow-menu-option>

          <cds-overflow-menu-option (selected)="switchView('tile')">{{
            'interface.list.viewMode.tile' | translate
          }}</cds-overflow-menu-option>
        </cds-overflow-menu>

        <ng-template #viewModeTrigger>
          <svg cdsIcon="settings--view" size="16"></svg>
        </ng-template>
      </ng-container>

      <ng-content select="[carbonToolbarContent]"> </ng-content>
    </cds-table-toolbar-content>
  </cds-table-toolbar>

  <ng-template #actionsMenu let-data="data">
    <cds-overflow-menu (click)="$event.stopPropagation()">
      <cds-overflow-menu-option
        *ngFor="let action of data.actions"
        [type]="action.type"
        (selected)="action.callback(data.item)"
      >
        <i *ngIf="!!action.iconClass" [ngClass]="action.iconClass"></i>

        {{ action.label | translate }}
      </cds-overflow-menu-option>
    </cds-overflow-menu>
  </ng-template>

  <cds-table
    *ngIf="(!viewMode || viewListAs === 'table') && !!obs.sort"
    [enableSingleSelect]="enableSingleSelect"
    [model]="loading ? skeletonModel : model"
    [showSelectionColumn]="showSelectionColumn"
    [skeleton]="loading"
    [striped]="striped"
    (sort)="onSort(model.header[$event])"
    (rowClick)="onRowClick($event)"
  >
    <tbody cdsTableBody>
      <tr>
        <td
          [attr.colspan]="model.header.length + (showSelectionColumn ? 1 : 0)"
          class="valtimo-carbon-list__no-results"
        >
          <ng-content></ng-content>
        </td>

        <td [attr.colspan]="model.header.length + (showSelectionColumn ? 1 : 0)">
          {{ 'list.noResults' | translate }}
        </td>
      </tr>
    </tbody>
  </cds-table>

  <div
    *ngIf="viewMode && viewListAs === 'tile'"
    class="container-fluid"
    [attr.data-carbon-theme]="theme"
  >
    <div class="row p-2">
      <div
        class="col-12 col-sm-6 col-xl-4 p-2"
        *ngFor="let item of model.data | listFilter: searchModel; let index = index"
        (click)="onClickRow(items[index])"
      >
        <div class="click-able tile-holder p-4">
          <dl class="row mb-0" *ngFor="let column of model.header; let index = index">
            <ng-container *ngIf="![ViewType.ACTION, ViewType.TEMPLATE].includes(column.viewType)">
              <dt class="col-12 col-md-5 text-xl-right">{{ column.data }}</dt>

              <dd class="col-12 col-md-7">{{ item[index].data }}</dd>
            </ng-container>
          </dl>
        </div>
      </div>

      <div *ngIf="!model.data.length">
        {{ 'list.noResults' | translate }}
      </div>

      <div class="col-12" *ngIf="!(model.data | listFilter: searchModel).length && !!searchModel">
        {{ 'list.noMatchingItems' | translate }}<i>"{{ searchModel }}"</i>
      </div>
    </div>
  </div>

  <cds-pagination
    *ngIf="paginationModel && items.length"
    [itemsPerPageOptions]="paginatorConfig.itemsPerPageOptions"
    [model]="paginationModel"
    [showPageInput]="paginatorConfig.showPageInput"
    [skeleton]="loading"
    [translations]="paginationTranslations$ | async"
    (selectPage)="onSelectPage($event)"
  ></cds-pagination>
</cds-table-container>

<ng-template #actionItem let-data="data">
  <i
    class="action-icon"
    style="cursor: pointer"
    [ngClass]="data.iconClass"
    (click)="$event.stopPropagation(); data.callback(data.item)"
  ></i>
</ng-template>
