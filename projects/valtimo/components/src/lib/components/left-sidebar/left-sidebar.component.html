<!--
  ~ Copyright 2015-2020 Ritense BV, the Netherlands.
  ~
  ~ Licensed under EUPL, Version 1.2 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ https://joinup.ec.europa.eu/collection/eupl/eupl-text-eupl-12
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" basis,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<ibm-sidenav
  *ngIf="{currentRoute: currentRoute$ | async, sideBarExpanded: sideBarExpanded$ | async} as obs"
  [allowExpansion]="false"
  [expanded]="obs.sideBarExpanded"
  (toggle)="toggled()"
>
  <ng-container *ngFor="let menuItem of menuItems$ | async">
    <ng-container *ngIf="!menuItem.children">
      <ng-container
        *ngTemplateOutlet="
          topMenuItem;
          context: {menuItem: menuItem, currentRoute: obs.currentRoute}
        "
      ></ng-container>
    </ng-container>
    <ng-container *ngIf="menuItem.children">
      <ng-container *ngTemplateOutlet="topMenuItem; context: {menuItem: menuItem}"></ng-container>
      <ibm-sidenav-menu [title]="menuItem.title">
        <ibm-sidenav-item
          *ngFor="let childMenuItem of menuItem.children"
          [route]="childMenuItem.link"
          [active]="(childMenuItem.link | arrayToString) === (obs.currentRoute | urlPart: 2)"
        >
          <valtimo-menu-item-text [menuItem]="childMenuItem"></valtimo-menu-item-text>
        </ibm-sidenav-item>
      </ibm-sidenav-menu>
    </ng-container>
  </ng-container>
</ibm-sidenav>

<ng-template #topMenuItem let-menuItem="menuItem" let-currentRoute="currentRoute">
  <ibm-sidenav-item
    [route]="menuItem.link"
    *ngIf="!menuItem.children"
    [active]="(currentRoute | urlPart: 1) === (menuItem.link | arrayToString)"
  >
    <valtimo-menu-item-text [menuItem]="menuItem"></valtimo-menu-item-text>
  </ibm-sidenav-item>
</ng-template>

<!--<ng-container *ngIf="{isResizing: isResizing$ | async} as obs">-->
<!--  <div-->
<!--    class="be-left-sidebar"-->
<!--    [style.width.px]="menuIsOpen ? (menuWidth$ | async) : null"-->
<!--    [ngClass]="{'no-transition': obs.isResizing}"-->
<!--  >-->
<!--    <div class="left-sidebar-wrapper">-->
<!--      <a class="left-sidebar-toggle" href="javascript:void(0);"-->
<!--        ><valtimo-page-title></valtimo-page-title-->
<!--      ></a>-->
<!--      <div class="progress-widget" style="padding: 20px 0">-->
<!--        <ul class="sidebar-elements">-->
<!--          <li>-->
<!--            <a-->
<!--              #toggleButton-->
<!--              class="be-toggle-left-sidebar"-->
<!--              href="javascript:void(0);"-->
<!--              [title]="menuTooltipText$ | async"-->
<!--            >-->
<!--              <svg-->
<!--                xmlns="http://www.w3.org/2000/svg"-->
<!--                aria-hidden="true"-->
<!--                width="1em"-->
<!--                height="1em"-->
<!--                style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg)"-->
<!--                viewBox="0 0 24 24"-->
<!--                transform="rotate(360)"-->
<!--              >-->
<!--                <path [ngClass]="menuIsOpen ? 'd-1' : 'd-1-flipped'" />-->
<!--                <path [ngClass]="menuIsOpen ? 'd-2' : 'd-2-flipped'" />-->
<!--                <path [ngClass]="menuIsOpen ? 'd-3' : 'd-3-flipped'" />-->
<!--                <path [ngClass]="menuIsOpen ? 'd-4' : 'd-4-flipped'" />-->
<!--              </svg>-->
<!--              <span>{{ toggleMenuText$ | async }}</span>-->
<!--            </a>-->
<!--          </li>-->
<!--        </ul>-->
<!--      </div>-->
<!--      <div class="left-sidebar-spacer">-->
<!--        <div class="left-sidebar-scroll">-->
<!--          <div class="left-sidebar-content">-->
<!--            <valtimo-menu></valtimo-menu>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--    <div-->
<!--      class="resize-border"-->
<!--      (mouseenter)="enterBorder()"-->
<!--      (mouseleave)="leaveBorder()"-->
<!--      (mousedown)="resizeBorderClick($event)"-->
<!--      [ngClass]="{'resize-hover': (mouseIsOnResizeBorder$ | async) || obs.isResizing}"-->
<!--    ></div>-->
<!--  </div>-->
<!--</ng-container>-->
