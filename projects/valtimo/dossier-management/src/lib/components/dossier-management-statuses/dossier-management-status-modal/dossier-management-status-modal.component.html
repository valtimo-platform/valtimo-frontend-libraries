<!--
  ~ Copyright 2015-2024 Ritense BV, the Netherlands.
  ~
  ~ Licensed under EUPL, Version 1.2 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ https://joinup.ec.europa.eu/collection/eupl/eupl-text-eupl-12
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" basis,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<cds-modal
  *ngIf="{
    isAdd: isAdd$ | async,
    isEdit: isEdit$ | async,
    isClosed: isClosed$ | async,
    editingKey: editingKey$ | async
  } as obs"
  [open]="!obs.isClosed"
  size="sm"
>
  <cds-modal-header showCloseButton="true" (closeSelect)="onClose()">
    <h3 cdsModalHeaderHeading>
      {{ obs.isAdd ? ('dossierManagement.statuses.add' | translate) : '' }}
      {{ obs.isEdit ? ('dossierManagement.statuses.edit' | translate) : '' }}
    </h3>
  </cds-modal-header>

  <section cdsModalContent>
    <ng-container *ngTemplateOutlet="statusForm; context: {obs: obs}"></ng-container>
  </section>

  <cds-modal-footer>
    <ng-container *ngTemplateOutlet="buttons; context: {obs: obs}"></ng-container>
  </cds-modal-footer>
</cds-modal>

<ng-template #statusForm let-obs="obs">
  <form [formGroup]="statusFormGroup" class="status-form">
    <cds-label>
      {{ 'dossierManagement.statuses.columns.title' | translate }}

      <input cdsText formControlName="title" [attr.modal-primary-focus]="true" />
    </cds-label>

    <cds-label>
      {{ 'dossierManagement.statuses.columns.key' | translate }}

      <div class="edit-key-input">
        <input
          cdsText
          formControlName="key"
          [disabled]="!obs.editingKey"
          [placeholder]="
            obs.isAdd && !obs.editingKey
              ? ('dossierManagement.statuses.keyAutoGenerated' | translate)
              : ''
          "
        />

        <cds-icon-button *ngIf="!obs.editingKey" (click)="editKeyButtonClick()" kind="secondary">
          <svg class="cds--btn__icon" cdsIcon="edit" size="16"></svg>
        </cds-icon-button>
      </div>
    </cds-label>

    <cds-toggle
      [label]="'dossierManagement.statuses.visibleTitle' | translate"
      [onText]="'dossierManagement.statuses.visible' | translate"
      [offText]="'dossierManagement.statuses.invisible' | translate"
      [checked]="visibleInCaseListByDefault?.value"
      (checkedChange)="toggleCheckedChange($event)"
    ></cds-toggle>
  </form>
</ng-template>

<ng-template #buttons let-obs="obs">
  <button cdsButton="secondary" (click)="onClose()">
    {{ 'interface.cancel' | translate }}
  </button>

  <button
    *ngIf="obs.isAdd"
    cdsButton="primary"
    [disabled]="invalid || pristine"
    (click)="addStatus()"
  >
    {{ 'interface.add' | translate }}
  </button>

  <button
    *ngIf="obs.isEdit"
    cdsButton="primary"
    [disabled]="invalid || pristine"
    (click)="editStatus()"
  >
    {{ 'interface.save' | translate }}
  </button>
</ng-template>
